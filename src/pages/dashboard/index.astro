---
import DashboardLayout from '../../layouts/DashboardLayout.astro';
import { DashboardContent } from '../../components/dashboard/DashboardContent';
import { ProtectedRoute } from '../../components/auth/ProtectedRoute';
import SelectedRestaurantHeader from '../../components/dashboard/SelectedRestaurantHeader';
import DashboardMainLayout from '../../layouts/DashboardMainLayout';
import RestaurantValidator from '@/components/dashboard/RestaurantValidator';
---

<DashboardLayout title='Dashboard | Yuppie' section='dashboard'>
  <ProtectedRoute client:load>
    <DashboardMainLayout client:load>
      <RestaurantValidator client:only="react" />
      <SelectedRestaurantHeader client:load />
      <DashboardContent client:load />
    </DashboardMainLayout>
  </ProtectedRoute>
</DashboardLayout>

<script>
  import { auth } from '../../lib/firebase';
  import { onAuthStateChanged } from 'firebase/auth';
  if (auth) {
    onAuthStateChanged(auth, (user) => {
      if (!user) window.location.href = '/login';
    });
  } else {
    window.location.href = '/login';
  }
</script>
