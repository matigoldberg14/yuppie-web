---
import DashboardLayout from '../layouts/DashboardLayout.astro';
import { DashboardContent } from '../components/dashboard/DashboardContent';
import { auth } from '../lib/firebase';

// Verificar autenticación
const user = auth.currentUser;
if (!user) {
  return Astro.redirect('/login');
}

// Verificar si el usuario tiene un restaurante asignado
const response = await fetch(
  `${import.meta.env.PUBLIC_API_URL}/restaurants?filters[firebaseUID][$eq]=${user.uid}`
);
const { data } = await response.json();

if (!data || data.length === 0) {
  // Si no tiene restaurante asignado, mostrar mensaje
  console.error('Usuario sin restaurante asignado:', user.uid);
}
---

<DashboardLayout title="Dashboard">
  {data && data.length > 0 ? (
    <DashboardContent client:load />
  ) : (
    <div class="p-6 text-center">
      <h2 class="text-xl text-white mb-4">No tienes ningún restaurante asignado</h2>
      <p class="text-gray-400">Contacta al administrador para que te asigne un restaurante</p>
    </div>
  )}
</DashboardLayout>