---
import Layout from '../layouts/Layout.astro';
import { RatingForm } from '../components/feedback/Rating';
import { getRestaurant } from '../services/api';

const localId = Astro.url.searchParams.get('local');
if (!localId) {
  return Astro.redirect('/404');
}

const restaurant = await getRestaurant(localId);
console.log('Found restaurant:', restaurant); // Para debug

if (!restaurant) {
  return Astro.redirect('/404');
}
---

<Layout title="Califica tu experiencia">
  <div class="min-h-screen bg-black text-white px-4 py-8 flex flex-col items-center">
    <h1 class="text-3xl font-bold mb-12">
      {restaurant.name}
    </h1>
    
    <RatingForm 
      client:load 
      restaurantId={restaurant.id.toString()}
      nextUrl={`/improvement?local=${localId}`}
    />
  </div>
</Layout>