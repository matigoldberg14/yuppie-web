---
import Layout from '@/layouts/Layout.astro';
import Review from '@/sections/Review';
import { findRestaurantBySlug } from '@/services/api/restaurants';
import { findEmployeeById } from '@/services/api/employees';
import type { Employee, Restaurant } from '@/types';

const { restaurant: restaurantSlug } = Astro.params;

if (!restaurantSlug) {
  Astro.redirect('/');
}

const restaurant = await findRestaurantBySlug(restaurantSlug!);

if (!restaurant) {
  return Astro.redirect('/');
}

const employeeId = Astro.url.searchParams.get('e');
let employee: Employee | null = null;

if (employeeId) {
  employee = await findEmployeeById(employeeId, restaurant.documentId);

  if (!employee) {
    return Astro.redirect('/');
  }
}

let pageTitle = `Califica tu experiencia - ${restaurantSlug}`;
---

<Layout title={pageTitle}>
  <div
    class='min-h-screen bg-gradient flex flex-col items-center justify-center p-4'
  >
    <div class='w-full max-w-md flex flex-col items-center gap-4'>
      <h1 class='text-4xl font-bold text-center text-shadow'>
        {restaurant.name}
      </h1>

      <Review client:load restaurant={restaurant} />
    </div>
  </div>
</Layout>
