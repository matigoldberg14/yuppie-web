import{j as a}from"./jsx-runtime.7faW4zRM.js";import{r as l}from"./index.DhYZZe0J.js";const h="http://localhost:1337/api";async function f({restaurantId:s,typeImprovement:c,email:o,comment:m}){try{const e="rev_"+Math.random().toString(36).substr(2,9),i={data:{googleSent:!1,typeImprovement:c,email:o,date:new Date,comment:m,restaurant:s}};console.log("Sending to Strapi:",JSON.stringify(i,null,2));const n=await fetch(`${h}/reviews`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),t=await n.json();if(!n.ok)throw console.error("Strapi error response:",t),new Error(t.error?.message||JSON.stringify(t.error?.details)||"Error creating review");return t}catch(e){throw e instanceof Error?console.error("Error details:",e.message):console.error("Unknown error:",e),e}}function v({restaurantId:s,successUrl:c}){const[o,m]=l.useState(""),[e,i]=l.useState(""),[n,t]=l.useState(!1),[u,d]=l.useState(null),g=async()=>{try{d(null),t(!0);const r=localStorage.getItem("yuppie_improvement");if(console.log("Attempting to submit:",{restaurantId:s,typeImprovement:r,email:e,comment:o}),!r)throw new Error("Por favor, selecciona qué podemos mejorar");await f({restaurantId:s,typeImprovement:r,email:e,comment:o.trim()}),localStorage.removeItem("yuppie_improvement"),window.location.href=c}catch(r){const p=r instanceof Error?r.message:"Error desconocido";d(p),console.error("Error submitting review:",p)}finally{t(!1)}};return a.jsxs("div",{className:"w-full max-w-md flex flex-col gap-6",children:[a.jsx("h2",{className:"text-xl text-center",children:"Por último ¿Nos quisieras dejar un comentario?"}),u&&a.jsx("div",{className:"bg-red-500/10 text-red-400 p-4 rounded-lg text-sm",children:u}),a.jsx("textarea",{value:o,onChange:r=>m(r.target.value),placeholder:"Comentanos aquí.",className:"w-full p-4 rounded-lg bg-white/5 text-white placeholder-gray-400 resize-none h-40",required:!0}),a.jsx("input",{type:"email",value:e,onChange:r=>i(r.target.value),placeholder:"Tu email",className:"w-full p-4 rounded-lg bg-white/5 text-white placeholder-gray-400",required:!0}),a.jsx("button",{onClick:g,disabled:n||!e||!o.trim(),className:"w-full py-3 px-6 bg-white text-black rounded-full font-medium hover:bg-gray-100 disabled:opacity-50",children:n?"Enviando...":"Enviar"})]})}export{v as CommentForm};
